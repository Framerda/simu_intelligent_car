<!-- src/main/resources/static/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能小车控制平台</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- 引入我们完整的控制JS -->
  <script src="/js/control.js" defer></script>
  <style>
    /* 可以在这里添加一些额外的自定义样式 */
    .control-panel {
      margin-top: 20px;
    }
    .sensor-data {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    /* 视频流样式 */
    .video-container {
      position: relative;
      width: 100%;
      height: 400px;
      background-color: #000;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    #videoStream {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .video-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #666;
      background-color: #111;
    }

    .video-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }

    .camera-controls {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .stream-stats {
      font-family: monospace;
      font-size: 14px;
      color: #007bff;
      padding: 5px 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1 class="text-center">智能小车控制平台</h1>

  <!-- 视频流区域 -->
  <div class="card mt-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5>实时视频流</h5>
      <div>
        <span id="stream-status" class="stream-status disconnected">未连接</span>
        <span class="ms-2" id="stream-stats" class="stream-stats">FPS: -- | 分辨率: -- | 延迟: --ms</span>
      </div>
    </div>
    <div class="card-body">
      <div class="video-container">
        <img id="videoStream" src="" alt="实时视频流" style="display: none;">
        <div id="video-placeholder" class="video-placeholder">
          <p>点击下方按钮开始连接视频流</p>
          <p class="text-muted small">模拟视频流演示</p>
        </div>
      </div>

      <div class="video-controls">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary btn-sm" id="btn-stream-start">开始MJPEG流</button>
          <button class="btn btn-secondary btn-sm" id="btn-stream-ws">开始WebSocket流</button>
          <button class="btn btn-danger btn-sm" id="btn-stream-stop">停止视频流</button>
        </div>

        <div class="camera-controls ms-3">
          <span class="me-2">摄像头控制:</span>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-up">⬆️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-down">⬇️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-left">⬅️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-right">➡️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-center">⏺️</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 图片模拟显示区域 -->
  <div class="card mt-4">
    <div class="card-header">
      <h5>小车状态模拟视图</h5>
    </div>
    <div class="card-body text-center">
      <!-- 状态图片 -->
      <img id="carStatusImage" src="/img/car_stop.png" alt="小车状态"
           title="小车当前状态"
           style="max-width: 80%; border-radius: 10px; transition: opacity 0.3s;">
      <p class="mt-2 text-muted" id="car-direction">状态: 停止</p>
    </div>
  </div>

  <!-- 控制面板 -->
  <div class="card mt-4">
    <div class="card-header">
      <h5>控制面板</h5>
    </div>
    <div class="card-body text-center">
      <div class="btn-group mb-3" role="group" aria-label="方向控制">
        <!-- 按钮添加了ID，用于control.js绑定事件 -->
        <button type="button" class="btn btn-success" id="btn-forward">前进</button>
        <button type="button" class="btn btn-warning" id="btn-left">左转</button>
        <button type="button" class="btn btn-danger" id="btn-stop">停止</button>
        <button type="button" class="btn btn-warning" id="btn-right">右转</button>
        <button type="button" class="btn btn-success" id="btn-backward">后退</button>
      </div>

      <div class="mb-3">
        <button type="button" class="btn btn-outline-danger" id="btn-emergency">紧急停止</button>
      </div>

      <!-- 速度控制 -->
      <div class="speed-control mt-3">
        <label for="speed-slider" class="form-label">速度控制: <span id="speed-value">0</span>%</label>
        <input type="range" class="form-range" id="speed-slider" min="0" max="100" value="0">
      </div>
    </div>
  </div>

  <!-- 传感器数据显示 -->
  <div class="sensor-data">
    <h5>传感器数据</h5>
    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">前方距离</h6>
            <p class="card-text display-6" id="distance-front">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">左侧距离</h6>
            <p class="card-text display-6" id="distance-left">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">右侧距离</h6>
            <p class="card-text display-6" id="distance-right">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
    </div>

    <div class="row mt-3">
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">电池电量</h6>
            <div class="progress" style="height: 25px;">
              <div id="battery-indicator" class="progress-bar" role="progressbar"
                   style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                100%
              </div>
            </div>
            <small class="text-muted" id="battery-level">100%</small>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card">
          <div class="card-body">
            <h6 class="card-subtitle mb-2 text-muted">当前速度</h6>
            <p class="card-text display-6" id="current-speed">0</p>
            <small class="text-muted">单位</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 连接状态 -->
  <div class="mt-4">
    <div class="alert alert-info" role="alert">
      连接状态: <span id="connection-status" class="fw-bold">正在连接...</span>
    </div>
  </div>

  <!-- 通知容器 -->
  <div id="notification-container"></div>
</div>

<!-- 移除所有旧的内联JavaScript，功能已全部移至control.js -->
<!-- 只保留一个简单的页面加载检查 -->
<script>
  // 简单检查页面元素和JS是否加载
  document.addEventListener('DOMContentLoaded', function() {
    console.log('智能小车控制页面已加载');
    // 这里不再初始化，因为control.js中的DOMContentLoaded监听器会处理
  });
</script>
</body>
</html>