<!-- src/main/resources/static/index.html -->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>智能小车控制平台</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
  <!-- 引入自定义样式 -->
  <link rel="stylesheet" href="/css/style.css">
  <!-- 引入我们完整的控制JS -->
  <script src="/js/control.js" defer></script>
  <style>
    /* 可以在这里添加一些额外的自定义样式 */
    .control-panel {
      margin-top: 20px;
    }
    .sensor-data {
      margin-top: 20px;
      padding: 15px;
      background-color: #f8f9fa;
      border-radius: 8px;
    }

    /* 视频流样式 */
    .video-container {
      position: relative;
      width: 100%;
      height: 400px;
      background-color: #000;
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 15px;
    }

    #videoStream {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .video-placeholder {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      color: #666;
      background-color: #111;
    }

    .video-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
      align-items: center;
    }

    .camera-controls {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
    }

    .stream-stats {
      font-family: monospace;
      font-size: 14px;
      color: #007bff;
      padding: 5px 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
    }

    /* 控制按钮样式优化 */
    .control-btn {
      width: 80px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s ease;
      font-size: 1.2rem;
    }
    .control-btn:active {
      transform: scale(0.95);
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.2);
    }
    .control-btn i {
      font-size: 1.5rem;
    }

    /* 页面标题样式 */
    .page-title {
      background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    }
    .page-title h1 {
      margin: 0;
      font-size: 1.8rem;
    }
    .page-title small {
      opacity: 0.8;
    }

    /* 传感器卡片动画 */
    .sensor-card {
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .sensor-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
    }

    /* 加载动画 */
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading { animation: pulse 1.5s infinite; }
  </style>
</head>
<body>
<div class="container mt-4">
  <!-- 页面标题 -->
  <div class="page-title text-center">
    <h1><i class="bi bi-cpu me-2"></i>智能小车控制平台</h1>
    <small>远程控制 · 实时视频 · 传感器监控</small>
  </div>

  <!-- 视频流区域 -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center bg-dark text-white">
      <h5 class="mb-0"><i class="bi bi-camera-video me-2"></i>实时视频流</h5>
      <div>
        <span id="stream-status" class="stream-status disconnected">未连接</span>
        <span class="ms-2" id="stream-stats" class="stream-stats">FPS: -- | 分辨率: -- | 延迟: --ms</span>
      </div>
    </div>
    <div class="card-body">
      <div class="video-container">
        <img id="videoStream" src="" alt="实时视频流" style="display: none;">
        <div id="video-placeholder" class="video-placeholder">
          <p>点击下方按钮开始连接视频流</p>
          <p class="text-muted small">模拟视频流演示</p>
        </div>
      </div>

      <div class="video-controls">
        <div class="d-flex flex-wrap gap-2">
          <button class="btn btn-primary btn-sm" id="btn-stream-start">开始MJPEG流</button>
          <button class="btn btn-secondary btn-sm" id="btn-stream-ws">开始WebSocket流</button>
          <button class="btn btn-danger btn-sm" id="btn-stream-stop">停止视频流</button>
        </div>

        <div class="camera-controls ms-3">
          <span class="me-2">摄像头控制:</span>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-up">⬆️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-down">⬇️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-left">⬅️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-right">➡️</button>
          <button class="btn btn-outline-secondary btn-sm" id="btn-camera-center">⏺️</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 图片模拟显示区域 -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-light">
      <h5 class="mb-0"><i class="bi bi-ev-front me-2"></i>小车状态模拟视图</h5>
    </div>
    <div class="card-body text-center">
      <!-- 状态图片 -->
      <img id="carStatusImage" src="/img/car_stop.png" alt="小车状态"
           title="小车当前状态"
           style="max-width: 80%; border-radius: 10px; transition: opacity 0.3s;">
      <p class="mt-2 text-muted" id="car-direction">状态: 停止</p>
    </div>
  </div>

  <!-- 控制面板 -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0"><i class="bi bi-joystick me-2"></i>控制面板</h5>
    </div>
    <div class="card-body">
      <!-- 九宫格方向控制 -->
      <div class="direction-grid mx-auto" style="max-width: 280px;">
        <div class="d-grid gap-2" style="grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr);">
          <div></div>
          <button type="button" class="btn btn-success btn-lg control-btn" id="btn-forward" title="前进 (W/↑)">
            <i class="bi bi-arrow-up-circle-fill"></i>
            <span class="d-none d-md-inline ms-1">前进</span>
          </button>
          <div></div>
          <button type="button" class="btn btn-primary btn-lg control-btn" id="btn-left" title="左转 (A/←)">
            <i class="bi bi-arrow-left-circle-fill"></i>
            <span class="d-none d-md-inline ms-1">左转</span>
          </button>
          <button type="button" class="btn btn-danger btn-lg control-btn" id="btn-stop" title="停止 (空格)">
            <i class="bi bi-stop-circle-fill"></i>
            <span class="d-none d-md-inline ms-1">停止</span>
          </button>
          <button type="button" class="btn btn-primary btn-lg control-btn" id="btn-right" title="右转 (D/→)">
            <i class="bi bi-arrow-right-circle-fill"></i>
            <span class="d-none d-md-inline ms-1">右转</span>
          </button>
          <div></div>
          <button type="button" class="btn btn-success btn-lg control-btn" id="btn-backward" title="后退 (S/↓)">
            <i class="bi bi-arrow-down-circle-fill"></i>
            <span class="d-none d-md-inline ms-1">后退</span>
          </button>
          <div></div>
        </div>
      </div>

      <!-- 紧急停止 -->
      <div class="text-center mt-3 mb-3">
        <button type="button" class="btn btn-outline-danger btn-lg px-5" id="btn-emergency" title="紧急停止 (Esc)">
          <i class="bi bi-exclamation-octagon-fill me-2"></i>紧急停止
        </button>
      </div>
      
      <!-- 键盘快捷键提示 -->
      <div class="text-center">
        <small class="text-muted">
          <i class="bi bi-keyboard me-1"></i>
          键盘控制: W/↑前进 | S/↓后退 | A/←左转 | D/→右转 | 空格停止 | Esc紧急停止
        </small>
      </div>

      <!-- 速度控制 -->
      <div class="speed-control mt-3">
        <label for="speed-slider" class="form-label">速度控制: <span id="speed-value">0</span>%</label>
        <input type="range" class="form-range" id="speed-slider" min="0" max="100" value="0">
      </div>
    </div>
  </div>

  <!-- 传感器数据显示 -->
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-info text-white">
      <h5 class="mb-0"><i class="bi bi-speedometer2 me-2"></i>传感器数据</h5>
    </div>
    <div class="card-body">
    <div class="row g-3">
      <div class="col-md-4">
        <div class="card sensor-card h-100 border-0 bg-light">
          <div class="card-body text-center">
            <i class="bi bi-arrow-up-circle text-primary" style="font-size: 2rem;"></i>
            <h6 class="card-subtitle mt-2 text-muted">前方距离</h6>
            <p class="card-text display-5 fw-bold text-primary" id="distance-front">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card sensor-card h-100 border-0 bg-light">
          <div class="card-body text-center">
            <i class="bi bi-arrow-left-circle text-warning" style="font-size: 2rem;"></i>
            <h6 class="card-subtitle mt-2 text-muted">左侧距离</h6>
            <p class="card-text display-5 fw-bold text-warning" id="distance-left">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card sensor-card h-100 border-0 bg-light">
          <div class="card-body text-center">
            <i class="bi bi-arrow-right-circle text-success" style="font-size: 2rem;"></i>
            <h6 class="card-subtitle mt-2 text-muted">右侧距离</h6>
            <p class="card-text display-5 fw-bold text-success" id="distance-right">--</p>
            <small class="text-muted">厘米</small>
          </div>
        </div>
      </div>
    </div>

    <div class="row g-3 mt-2">
      <div class="col-md-6">
        <div class="card sensor-card h-100 border-0 bg-light">
          <div class="card-body">
            <div class="d-flex align-items-center mb-2">
              <i class="bi bi-battery-charging text-success me-2" style="font-size: 1.5rem;"></i>
              <h6 class="card-subtitle text-muted mb-0">电池电量</h6>
            </div>
            <div class="progress" style="height: 30px; border-radius: 15px;">
              <div id="battery-indicator" class="progress-bar bg-success progress-bar-striped progress-bar-animated" role="progressbar"
                   style="width: 100%;" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100">
                <span class="fw-bold" id="battery-level">100%</span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card sensor-card h-100 border-0 bg-light">
          <div class="card-body text-center">
            <i class="bi bi-speedometer text-danger" style="font-size: 2rem;"></i>
            <h6 class="card-subtitle mt-2 text-muted">当前速度</h6>
            <p class="card-text display-5 fw-bold text-danger" id="current-speed">0</p>
            <small class="text-muted">%</small>
          </div>
        </div>
      </div>
    </div>
    </div>
  </div>

  <!-- 连接状态 -->
  <div class="mt-4 mb-4">
    <div class="alert alert-info d-flex align-items-center" role="alert">
      <i class="bi bi-wifi me-2" style="font-size: 1.2rem;"></i>
      <span>连接状态: <span id="connection-status" class="fw-bold">正在连接...</span></span>
    </div>
  </div>

  <!-- 页脚 -->
  <footer class="text-center text-muted py-3 border-top">
    <small>智能小车控制平台 &copy; 2025 | 基于 Spring Boot + WebSocket</small>
  </footer>

  <!-- 通知容器 -->
  <div id="notification-container"></div>
</div>

<!-- 移除所有旧的内联JavaScript，功能已全部移至control.js -->
<!-- 只保留一个简单的页面加载检查 -->
<script>
  // 简单检查页面元素和JS是否加载
  document.addEventListener('DOMContentLoaded', function() {
    console.log('智能小车控制页面已加载');
    // 这里不再初始化，因为control.js中的DOMContentLoaded监听器会处理
  });
</script>
</body>
</html>